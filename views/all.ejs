<%- include('./partials/header') %>

<div class="w-full min-h-screen bg-zinc-800 px-4 py-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-white">Explore All Pins</h1>
            <% if (user) { %>
                <a href="/add" class="px-5 py-2 bg-red-600 hover:bg-red-700 text-white rounded-full text-sm font-semibold transition-colors">
                    Create Pin
                </a>
            <% } %>
        </div>

        <!-- Posts Grid -->
        <div class="columns-2 md:columns-3 lg:columns-4 gap-4 space-y-4">
            <% if (posts && posts.length > 0) { %>
                <% posts.forEach(function(post) { %>
                    <div class="break-inside-avoid mb-4">
                        <div class="bg-zinc-900 rounded-xl overflow-hidden group">
                            <a href="/post/<%= post._id %>" class="block relative">
                                <img src="<%= post.image %>" 
                                     alt="<%= post.title %>"
                                     class="w-full object-cover"
                                     onerror="this.src='/images/placeholder.png'">
                                <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                                    <div class="absolute bottom-0 left-0 right-0 p-4">
                                        <h3 class="text-white font-semibold truncate"><%= post.title %></h3>
                                        <div class="flex items-center gap-2 mt-2">
                                            <img src="<%= post.user.profileImage || '/images/placeholder.png' %>" 
                                                 class="w-6 h-6 rounded-full object-cover"
                                                 alt="<%= post.user.username %>">
                                            <p class="text-white text-sm">@<%= post.user.username %></p>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                <% }); %>
            <% } else { %>
                <div class="col-span-full flex flex-col items-center justify-center py-20">
                    <p class="text-zinc-400 text-xl">No pins found</p>
                    <% if (user) { %>
                        <a href="/add" class="mt-4 px-5 py-2 bg-red-600 hover:bg-red-700 text-white rounded-full text-sm font-semibold transition-colors">
                            Create First Pin
                        </a>
                    <% } %>
                </div>
            <% } %>
        </div>
    </div>
</div>

<script>
function resizeGridItem(item) {
    const grid = document.getElementsByClassName("posts-grid")[0];
    const rowHeight = parseInt(window.getComputedStyle(grid).getPropertyValue('grid-auto-rows'));
    const rowGap = parseInt(window.getComputedStyle(grid).getPropertyValue('grid-row-gap'));
    const itemContent = item.querySelector('.content');
    const rowSpan = Math.ceil((itemContent.getBoundingClientRect().height + rowGap) / (rowHeight + rowGap));
    item.style.gridRowEnd = "span " + rowSpan;
}
</script>

<%- include('./partials/footer') %>